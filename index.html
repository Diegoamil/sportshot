<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <link rel="icon" type="image/svg+xml" href="/vite.svg" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Sports Photo Platform with Facial Recognition</title>
    <style>
      .loading-overlay {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(255, 255, 255, 0.9);
        display: flex;
        justify-content: center;
        align-items: center;
        z-index: 9999;
        font-family: Arial, sans-serif;
      }
      .loading-content {
        text-align: center;
      }
      .loading-text {
        font-size: 24px;
        margin-top: 20px;
        color: #333;
      }
    </style>
  </head>
  <body>
    <div id="root"></div>
    
    <!-- Loading overlay que será mostrado durante o carregamento -->
    <div id="loading-overlay" class="loading-overlay">
      <div class="loading-content">
        <div class="loading-text">Carregando SportShot...</div>
      </div>
    </div>
    
    <script>
      // IIFE para isolar o escopo
      (function() {
        // Verifica se estamos no ambiente EasyPanel
        function isEasyPanelEnvironment() {
          return window.location.hostname.includes('easypanel.host');
        }
        
        // Função para carregar a aplicação via fetch e injeção de conteúdo
        function loadViaFallback() {
          console.log('Carregando aplicação via fallback...');
          
          // Determina a URL base para os assets
          const baseUrl = window.location.origin;
          
          // Carrega o CSS primeiro
          fetch(baseUrl + '/assets/index.DpF1_0n5.css')
            .then(response => {
              if (!response.ok) throw new Error('Falha ao carregar CSS');
              return response.text();
            })
            .then(cssContent => {
              // Injeta o CSS na página
              const styleEl = document.createElement('style');
              styleEl.textContent = cssContent;
              document.head.appendChild(styleEl);
              
              // Agora carrega o JavaScript
              return fetch(baseUrl + '/assets/index.DpcMrbSZ.js');
            })
            .then(response => {
              if (!response.ok) throw new Error('Falha ao carregar JavaScript');
              return response.text();
            })
            .then(jsContent => {
              // Verifica se o conteúdo parece ser HTML (erro comum)
              if (jsContent.trim().startsWith('<!DOCTYPE') || jsContent.trim().startsWith('<html')) {
                throw new Error('Recebeu HTML em vez de JavaScript');
              }
              
              // Cria um novo script e injeta o conteúdo
              const scriptEl = document.createElement('script');
              scriptEl.textContent = jsContent;
              document.body.appendChild(scriptEl);
              
              // Remove o overlay de carregamento após um pequeno delay
              setTimeout(() => {
                const loadingOverlay = document.getElementById('loading-overlay');
                if (loadingOverlay) {
                  loadingOverlay.style.opacity = '0';
                  loadingOverlay.style.transition = 'opacity 0.5s';
                  setTimeout(() => loadingOverlay.remove(), 500);
                }
              }, 1000);
            })
            .catch(error => {
              console.error('Erro no fallback:', error);
              const loadingText = document.querySelector('.loading-text');
              if (loadingText) {
                loadingText.textContent = 'Erro ao carregar aplicação. Por favor, recarregue a página.';
                loadingText.style.color = 'red';
              }
            });
        }
        
        // Se estamos no EasyPanel, carrega via fallback imediatamente
        if (isEasyPanelEnvironment()) {
          // Não precisamos esperar pelo DOMContentLoaded pois o script está no final do body
          loadViaFallback();
        } else {
          // Se não estamos no EasyPanel, carrega normalmente e remove o overlay
          const script = document.createElement('script');
          script.type = 'module';
          script.src = '/src/main.tsx';
          script.onerror = function(e) {
            // Fallback se ocorrer erro mesmo fora do EasyPanel
            if (e.message && e.message.includes('MIME type')) {
              loadViaFallback();
            }
          };
          document.body.appendChild(script);
          
          // Remove o overlay após um pequeno delay
          setTimeout(() => {
            const loadingOverlay = document.getElementById('loading-overlay');
            if (loadingOverlay) {
              loadingOverlay.style.opacity = '0';
              loadingOverlay.style.transition = 'opacity 0.5s';
              setTimeout(() => loadingOverlay.remove(), 500);
            }
          }, 1000);
        }
        
        // Captura erros globais como backup
        window.addEventListener('error', function(e) {
          if (e.message && (e.message.includes('MIME type') || e.message.includes('Unexpected token'))) {
            loadViaFallback();
            // Previne que o erro seja exibido no console
            e.preventDefault();
          }
        }, true);
      })();
    </script>
  </body>
</html>
