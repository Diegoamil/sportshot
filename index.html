<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <link rel="icon" type="image/svg+xml" href="/vite.svg" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Sports Photo Platform with Facial Recognition</title>
    <script>
      // Verifica se estamos no EasyPanel
      if (window.location.hostname.includes('easypanel.host')) {
        // Override da função importScripts para corrigir MIME type
        window.importScripts = function(url) {
          return new Promise((resolve, reject) => {
            fetch(url)
              .then(response => response.text())
              .then(code => {
                // Executa o código usando eval em vez de importar como módulo
                try {
                  eval(code);
                  resolve();
                } catch (e) {
                  reject(e);
                }
              })
              .catch(reject);
          });
        };
      }
    </script>
  </head>
  <body>
    <div id="root"></div>
    <script type="module" src="/src/main.tsx"></script>
    <!-- Script de fallback que será executado se o módulo falhar ao carregar -->
    <script>
      // Executa imediatamente para verificar se estamos no EasyPanel
      (function() {
        // Função para verificar se estamos no ambiente EasyPanel
        function isEasyPanelEnvironment() {
          return window.location.hostname.includes('easypanel.host');
        }
        
        // Função para carregar a aplicação via fallback
        function loadViaFallback() {
          console.log('Carregando aplicação via fallback...');
          
          // Remove o script principal se existir
          const mainScript = document.querySelector('script[src="/src/main.tsx"]');
          if (mainScript) {
            mainScript.remove();
          }
          
          // Cria elemento de carregamento
          const loadingEl = document.createElement('div');
          loadingEl.innerHTML = 'Carregando SportShot...';
          loadingEl.style.position = 'fixed';
          loadingEl.style.top = '50%';
          loadingEl.style.left = '50%';
          loadingEl.style.transform = 'translate(-50%, -50%)';
          loadingEl.style.fontFamily = 'Arial, sans-serif';
          loadingEl.style.fontSize = '24px';
          loadingEl.style.color = '#333';
          document.body.appendChild(loadingEl);
          
          // Determina a URL base para os assets
          const baseUrl = window.location.origin;
          
          // Carrega os assets diretamente com caminhos absolutos
          const cssLink = document.createElement('link');
          cssLink.rel = 'stylesheet';
          cssLink.href = baseUrl + '/assets/index.DpF1_0n5.css';
          document.head.appendChild(cssLink);
          
          const jsScript = document.createElement('script');
          jsScript.src = baseUrl + '/assets/index.DpcMrbSZ.js';
          jsScript.onload = function() {
            setTimeout(() => loadingEl.remove(), 1000);
          };
          jsScript.onerror = function(error) {
            console.error('Erro ao carregar script:', error);
            loadingEl.innerHTML = 'Erro ao carregar aplicação. Recarregue a página.';
            loadingEl.style.color = 'red';
          };
          document.body.appendChild(jsScript);
        }
        
        // Se estamos no EasyPanel, carrega via fallback imediatamente
        if (isEasyPanelEnvironment()) {
          document.addEventListener('DOMContentLoaded', loadViaFallback);
        }
        
        // Captura erros de MIME type para casos onde a detecção prévia falha
        window.addEventListener('error', function(e) {
          // Verifica se o erro é relacionado a MIME type
          if (e.message && e.message.includes('MIME type')) {
            loadViaFallback();
          }
        }, true);
      })();
    </script>
  </body>
</html>
